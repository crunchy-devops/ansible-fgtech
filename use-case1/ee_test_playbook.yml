---
- name: üß™ V√âRIFICATION DE LA COMPATIBILIT√â AVEC LA DETTE TECHNIQUE
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: 1. Confirmer l'interpr√©teur de l'EE (Moteur)
      ansible.builtin.command: /usr/bin/python --version
      register: ee_python_check
      changed_when: false

    - name: Afficher le moteur d'ex√©cution (Python 3.x)
      ansible.builtin.debug:
        msg: "‚úÖ Moteur d'ex√©cution EE (localhost) : {{ ee_python_check.stdout | trim }}"

    - name: 2. Confirmer la version d'Ansible (2.9.27)
      ansible.builtin.command: ansible-playbook --version
      register: ansible_version_check
      changed_when: false

    - name: Confirmer la version d'Ansible Runner (2.3.2)
      ansible.builtin.command: ansible-runner --version
      register: runner_version_check
      changed_when: false

    - name: Afficher les versions valid√©es
      ansible.builtin.debug:
        msg: |
          "--- R√âSULTATS DE L'EE ---
          Ansible Version: {{ ansible_version_check.stdout_lines[0] | regex_replace('.*([0-9]+\\.[0-9]+\\.[0-9]+).*', '\\1') }}
          Ansible Runner Version: {{ runner_version_check.stdout_lines[0] | trim }} (Compatible AWX)
          "
      failed_when: "'2.9.27' not in ansible_version_check.stdout"

# --------------------------------------------------------------------------------------
- name: üöÄ TESTER LE R√îLE SUR LA CIBLE ANCIENNE (CentOS 7 / Python 2.7.5)
  hosts: ee_test # H√¥tes avec Python 2.7
  gather_facts: false

  tasks:
    - name: 3. Tester la connexion et v√©rifier l'interpr√©teur sur l'h√¥te cible
      # Ansible utilise ici l'interpr√©teur /usr/bin/python de l'h√¥te cible (qui est Python 2.7.5)
      ansible.builtin.command: /usr/bin/python -V
      register: target_python_check

    - name: Afficher l'interpr√©teur de la cible
      ansible.builtin.debug:
        msg: "‚úÖ Interpr√©teur de la cible : {{ target_python_check.stderr | trim }} (Validation Python 2.7.x)"

    - name: 4. Ex√©cuter un module Ansible 2.9 (yum)
      ansible.builtin.yum:
        name: httpd
        state: present
      register: yum_result

    - name: Confirmer le succ√®s sur la cible
      ansible.builtin.debug:
        msg: "‚úÖ Test de Playbook 2.9 r√©ussi sur cible ancienne."