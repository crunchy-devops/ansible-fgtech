---
- name: üß™ V√âRIFICATION DE L'EE ANSIBLE (LOCALHOST)
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: 1. V√©rifier la version d'Ansible (doit √™tre 2.9.13)
      # Utilisation du binaire ansible-playbook pour v√©rifier la version install√©e dans l'EE
      ansible.builtin.command: ansible-playbook --version
      register: ansible_version_check
      changed_when: false

    - name: Afficher la version d'Ansible
      ansible.builtin.debug:
        msg: "‚úÖ Version d'Ansible trouv√©e: {{ ansible_version_check.stdout_lines[0] | regex_replace('.*([0-9]+\\.[0-9]+\\.[0-9]+).*', '\\1') }}"

    - name: 2. V√©rifier l'interpr√©teur Python de l'EE (pour confirmation 2.7.5)
      # Utiliser 'which python' pour trouver le chemin, puis v√©rifier la version.
      ansible.builtin.command: which python
      register: python_path_check
      changed_when: false

    - name: 3. Afficher et valider la version de Python
      ansible.builtin.command: "{{ python_path_check.stdout | trim }} -V"
      register: python_version_check
      changed_when: false

    - name: Afficher la version de Python
      ansible.builtin.debug:
        msg: "‚úÖ Version de Python de l'EE: {{ python_version_check.stderr | trim }}"

    - name: 4. Test d'un module basique (file) dans l'EE
      # Cette t√¢che DOIT cibler localhost car c'est un test de la capacit√© de l'EE.
      ansible.builtin.file:
        path: /tmp/ee_test_ansible_29.txt
        state: touch
        mode: '0644'
      delegate_to: localhost
      register: file_result

    - name: Confirmer le succ√®s du module 'file'
      ansible.builtin.debug:
        msg: "‚úÖ Module 'file' (Ansible 2.9) test√© avec succ√®s dans l'EE."

---
## üöÄ TEST DE CONNEXION ET DE D√âPLOIEMENT SUR LA CIBLE CENTOS 7

- name: Ex√©cuter des t√¢ches sur les h√¥tes cibles distants
  hosts: vos_serveurs_centos7 # Remplacer par le groupe/h√¥te cible
  gather_facts: false # Collecte des faits d√©sactiv√©e pour plus de rapidit√©

  tasks:
    - name: 5. Assurer l'utilisation de Python 2.7 sur l'h√¥te cible
      # Configure l'interpr√©teur pour le serveur CentOS 7 distant
      ansible.builtin.set_fact:
        ansible_python_interpreter: /usr/bin/python

    - name: 6. TEST CRITIQUE : Utiliser 'ping' pour v√©rifier la connexion SSH/Python
      ansible.builtin.ping:
      register: ping_result

    - name: Afficher le r√©sultat du ping
      ansible.builtin.debug:
        msg: "‚úÖ Connexion √† l'h√¥te cible r√©ussie (Ping: {{ ping_result.ping }})"

    - name: 7. Tester un module sp√©cifique √† CentOS 7 (yum)
      # L'absence de delegate_to garantit que cette t√¢che s'ex√©cute sur l'h√¥te cibl√©.
      ansible.builtin.yum:
        name: wget
        state: present
      register: yum_result

    - name: Confirmer le succ√®s du module 'yum'
      ansible.builtin.debug:
        msg: "‚úÖ Module 'yum' (Ansible 2.9) test√© sur l'h√¥te distant. Changement: {{ yum_result.changed }}"