---
- name: ðŸ§ª VÃ‰RIFICATION DE L'EE ANSIBLE 2.9.13 / PYTHON 2.7.5 (VENV)
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: 1. VÃ©rifier le chemin d'exÃ©cution de Python (doit Ãªtre dans le VENV)
      # Utiliser la variable d'environnement pour vÃ©rifier le chemin configurÃ©
      ansible.builtin.debug:
        msg: "âœ… InterprÃ©teur Python attendu: {{ lookup('env', 'ANSIBLE_PYTHON_INTERPRETER') }}"

    - name: 2. VÃ©rifier la version de Python (doit Ãªtre 2.7.5)
      # ExÃ©cuter directement le binaire Python du venv
      ansible.builtin.command: /opt/ansible_ee_venv/bin/python -V
      register: python_version_check
      changed_when: false

    - name: Afficher la version de Python
      ansible.builtin.debug:
        msg: "âœ… Version de Python de l'EE: {{ python_version_check.stderr | trim }}"
      # VÃ©rification pour s'assurer que l'interprÃ©teur a trouvÃ© la bonne version
      failed_when: "'Python 2.7' not in python_version_check.stderr"

    - name: 3. VÃ©rifier la version d'Ansible (doit Ãªtre 2.9.13)
      # La commande 'ansible-playbook' utilise le PATH du VENV
      ansible.builtin.command: ansible-playbook --version
      register: ansible_version_check
      changed_when: false

    - name: Afficher la version d'Ansible
      ansible.builtin.debug:
        msg: "âœ… Version d'Ansible: {{ ansible_version_check.stdout_lines[0] | regex_replace('.*([0-9]+\\.[0-9]+\\.[0-9]+).*', '\\1') }}"

    # Reste du Playbook (Connexion aux hÃ´tes distants)
# ... (Les Ã©tapes de 4 Ã  7 du Playbook prÃ©cÃ©dent, sans delegate_to: localhost)